<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kho Phôi cuộn</title>

      <!-- Logo hiển thị trên tab -->
  <link rel="icon" type="image/png" href="Logo DDC.png">
    
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        header {
            height: 60px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        nav li {
            margin-left: 10px;
        }

        nav a {
            display: block;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: #34495e;
        }

        nav a.active {
            background-color: #3498db;
            font-weight: bold;
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
        }

        .weather-info span {
            display: flex;
            align-items: center;
        }

        .weather-info .time {
            font-weight: bold;
        }

        .weather-info .location {
            color: #bdc3c7;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        iframe {
            flex: 1;
            border: none;
            width: 100%;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Web củ chuối</div>

        <nav>
            <ul>
                <li><a href="#" class="active" data-src="https://www.appsheet.com/start/96150c7d-7024-4c61-b3f9-092317ed00b8?platform=desktop#appName=DDC-272937291&vss=H4sIAAAAAAAAA6WOOw7CMBAFr4Je7RO4RRQIQUNEg1OYeAMWiR3FDhBZPg-H4DTcBIePoAXKfasZTcBB03HpZbEHX4f3NaMeHEEg6xsS4AJja3xrKwEmsJD1Y8xaabajYne9nAUiYs5eCk8OPHxt4H83MGhFxutSUzvoBjhpnmh6D2AaPjBEhrrzclPRvTxhMaattEXnSK1S0G8hbmomp0YaNbcqWUtZOYo3Bibst3QBAAA=&view=Trang%20ch%E1%BB%A7">Bão-Test</a></li>
                <li><a href="#" data-src="https://lookerstudio.google.com/embed/reporting/35a746c7-fd59-4273-a896-5c6779217bc5/page/OAvkF">Dashboard phế liệu</a></li>
                <li><a href="#" data-src="https://lookerstudio.google.com/embed/reporting/23293f3e-06f6-40fc-a54a-926c0b1ba79d/page/gielF">Dashboard XG - demo</a></li>
            </ul>
        </nav>

        <!-- Thời gian thực + nhiệt độ + địa điểm (từ thiết bị) -->
        <div class="weather-info">
            <span class="time" id="current-time">Đang tải...</span>
            <span class="temp" id="current-temp">Đang tải...</span>
            <span class="location" id="current-location">Đang xác định vị trí...</span>
        </div>
    </header>

    <iframe id="content-frame" src="https://www.appsheet.com/start/96150c7d-7024-4c61-b3f9-092317ed00b8?platform=desktop#appName=DDC-272937291&vss=H4sIAAAAAAAAA6WOOw7CMBAFr4Je7RO4RRQIQUNEg1OYeAMWiR3FDhBZPg-H4DTcBIePoAXKfasZTcBB03HpZbEHX4f3NaMeHEEg6xsS4AJja3xrKwEmsJD1Y8xaabajYne9nAUiYs5eCk8OPHxt4H83MGhFxutSUzvoBjhpnmh6D2AaPjBEhrrzclPRvTxhMaattEXnSK1S0G8hbmomp0YaNbcqWUtZOYo3Bibst3QBAAA=&view=Trang%20ch%E1%BB%A7" allowfullscreen></iframe>

    <script>
        // Phần tab iframe (giữ nguyên)
        const tabs = document.querySelectorAll('nav a');
        const iframe = document.getElementById('content-frame');

        tabs.forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                const newSrc = this.getAttribute('data-src');
                if (newSrc && iframe.src !== newSrc) {
                    iframe.src = newSrc;
                }
            });
        });

    // Thời gian thực (múi giờ thiết bị)
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('vi-VN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('current-time').textContent = timeString;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Lấy vị trí + thời tiết + địa điểm tên thật
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // 1. Lấy thời tiết từ Open-Meteo
                    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`;

                    fetch(weatherUrl)
                        .then(response => response.json())
                        .then(data => {
                            if (data.current) {
                                const temp = Math.round(data.current.temperature_2m);
                                const weatherCode = data.current.weather_code;
                                let description = 'Trời quang';
                                if (weatherCode >= 51 && weatherCode <= 67) description = 'Mưa';
                                else if (weatherCode >= 71 && weatherCode <= 77) description = 'Tuyết';
                                else if (weatherCode >= 80) description = 'Mưa rào';
                                else if (weatherCode >= 3) description = 'Mây';
                                document.getElementById('current-temp').textContent = `${temp}°C - ${description}`;
                            } else {
                                document.getElementById('current-temp').textContent = 'Không lấy được nhiệt độ';
                            }
                        })
                        .catch(() => {
                            document.getElementById('current-temp').textContent = 'Lỗi thời tiết';
                        });

                    // 2. Reverse geocoding từ BigDataCloud (tên địa điểm)
                    const geoUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=vi`;

                    fetch(geoUrl)
                        .then(response => response.json())
                        .then(data => {
                            let locationText = 'Không xác định';
                            if (data.city || data.locality || data.principalSubdivision) {
                                locationText = [
                                    data.city || data.locality,
                                    data.principalSubdivision
                                ].filter(Boolean).join(', ') || data.countryName;
                            } else if (data.countryName) {
                                locationText = data.countryName;
                            }
                            document.getElementById('current-location').textContent = locationText;
                        })
                        .catch(() => {
                            // Fallback nếu API lỗi: hiển thị tọa độ
                            document.getElementById('current-location').textContent = `Vĩ độ ${lat.toFixed(2)}, Kinh độ ${lon.toFixed(2)}`;
                        });
                },
                error => {
                    console.error('Lỗi geolocation:', error);
                    document.getElementById('current-location').textContent = 'Vị trí bị từ chối';
                    document.getElementById('current-temp').textContent = 'Không xác định';
                }
            );
        } else {
            document.getElementById('current-location').textContent = 'Trình duyệt không hỗ trợ vị trí';
        }
    </script>
</body>
</html>
